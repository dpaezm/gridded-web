<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gridded.Agency</title>
    <link rel="icon" href="/favicon.png?v=1" type="image/png" />

    <!-- Google Analytics (Consent Mode bloqueado por defecto) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JD720QFSJ8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("consent", "default", {
        ad_storage: "denied",
        analytics_storage: "denied",
      });
      gtag("js", new Date());
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>

    <!-- CookieYes script (al final del body) -->
    <script
      id="cookieyes"
      type="text/javascript"
      src="https://cdn-cookieyes.com/client_data/1dd7962301f49134dd26a86f/script.js"
    ></script>

    <!-- Consentimiento GA dinámico con CookieYes -->
    <script>
      // Activar GA tras consentimiento manual y actualizar Consent Mode
      function updateConsentFromCookieYes() {
        // Compatibilidad: CookieYes v3 y v4
        let analyticsConsent = false;
        let adConsent = false;
        if (window.CookieYes && typeof window.CookieYes.getUserConsent === 'function') {
          // v4
          const consent = window.CookieYes.getUserConsent();
          analyticsConsent = consent.analytics === 'yes';
          adConsent = consent.advertisement === 'yes';
        } else if (window.CookieYes?.consent) {
          // v3
          analyticsConsent = window.CookieYes.consent.analytics === true;
          adConsent = window.CookieYes.consent.advertisement === true;
        }
        gtag('consent', 'update', {
          analytics_storage: analyticsConsent ? 'granted' : 'denied',
          ad_storage: adConsent ? 'granted' : 'denied',
        });
        if (analyticsConsent) {
          gtag('config', 'G-JD720QFSJ8');
          console.log('✅ GA activado tras consentimiento (CookieYes)');
        }
      }

      // Escuchar evento de CookieYes
      window.addEventListener('cookieyes_consent_update', updateConsentFromCookieYes);

      // Si ya hay consentimiento al cargar, ejecuta una vez
      window.addEventListener('DOMContentLoaded', function() {
        setTimeout(updateConsentFromCookieYes, 500);
      });
    </script>
  </body>
</html>
